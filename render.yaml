# Blueprint for deploying the Infocus API and PostgreSQL database on Render.

# 1. Create a PostgreSQL database
databases:
  - name: infocus-db
    databaseName: infocusdb
    user: infocus
    plan: free # Using the free instance type

# 2. Create the web service for the API
services:
  - type: web
    name: infocus-api
    env: node
    plan: free # Using the free instance type
    # Tell Render where the root of the pnpm monorepo is
    rootDir: .
    # Build command: install dependencies AND then run the build script for the monorepo
    buildCommand: pnpm install --frozen-lockfile && pnpm run build
    # Start command for the specific API service
    startCommand: pnpm --filter api start
    envVars:
      - key: NODE_VERSION
        value: 18
      # Link the database connection string to the API service
      - key: DATABASE_URL
        fromDatabase:
          name: infocus-db
          property: connectionString
      # Placeholder for the TMDB API key.
      # IMPORTANT: Set this secret value in the Render dashboard.
      - key: TMDB_API_KEY
        sync: false
